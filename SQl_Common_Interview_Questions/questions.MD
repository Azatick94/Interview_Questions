

<h2>* 4 основных типы соединения в SQL<br></h2>
Соединение таблиц может быть внутренним (INNER) или внешним (OUTER), причём внешнее соединение может быть левым (LEFT), правым (RIGHT) или полным (FULL).

![](joins.jpg)

INNER JOIN — получение записей с одинаковыми значениями в обеих таблицах, т.е. получение пересечения таблиц.<br>
FULL OUTER JOIN — объединяет записи из обеих таблиц (если условие объединения равно true) и дополняет их всеми записями из обеих таблиц, которые не имеют совпадений. Для записей, которые не имеют совпадений из другой таблицы, недостающее поле будет иметь значение NULL.<br>
LEFT JOIN — возвращает все записи, удовлетворяющие условию объединения, плюс все оставшиеся записи из внешней (левой) таблицы, которые не удовлетворяют условию объединения.<br>
RIGHT JOIN — работает точно так же, как и левое объединение, только в качестве внешней таблицы будет использоваться правая.<br>

<h2>* Для чего нужен оператор UNION? </h2>
Он используется для объединения полученных данных из двух или более запросов, которые должны иметь одинаковое количество столбцов с одинаковыми типами данных и расположенных в том же порядке.

Пример использования:

<i> SELECT column(s) FROM first_table
UNION
SELECT column(s) FROM second_table;</i>

<h5> Разница между UNION и UNION ALL</h5>
UNION удаляет повторяющиеся записи (где все столбцы в результатах одинаковы), UNION ALL - не удаляет.
При использовании UNION вместо UNION ALL наблюдается снижение производительности , поскольку сервер баз данных должен выполнять дополнительную работу по удалению дубликатов строк, но обычно дубликаты не нужны (особенно при разработке отчетов).<br>
* UNION выполняет функцию DISTINCT в результирующем наборе, устраняя все повторяющиеся строки.<br>
* Объединение всех не удаляет дубликатов, а это поэтому быстрее чем UNION.

<h2>* Что такое нормализация и денормализация данных? </h2>
Нормализация отношений в SQL призвана организовать информацию в базе данных таким образом, чтобы она не занимала много места и с ней было удобно работать. Это удаление избыточных данных, устранение дублей, идентификация наборов связанных данных через PRIMARY KEY, etc.


<h2>* Объясните разницу между командами DELETE и TRUNCATE ?</h2>
Команда DELETE — это DML-операция, которая удаляет записи из таблицы, соответствующие заданному условию:<br>


<table>
<caption>Таблица Delete vs Truncate</caption>
    <tr>
    <th>DELETE</th>
    <th>TRUNCATE</th>
    </tr>
    <tr><td>Используется для удаления строки в таблице</td><td>Используется для удаления всех строк из таблицы</td></tr>
    <tr><td>Вы можете восстановить данные после удаления</td><td>Вы не можете восстановить данные (прим. перевод.: операции логируются по разному, но в SQL Server есть возможность сделать откат) транзакции)</td></tr>
    <tr><td>DML-команда</td><td>DDL-команда</td></tr>
    <tr><td>Медленнее, чем оператор TRUNCATE</td><td>Быстрее</td></tr>
</table>


<i>DELETE FROM table_name WHERE condition;</i>
При этом создаются логи удаления, то есть операцию можно отменить.

А вот команда TRUNCATE — это DDL-операция, которая полностью пересоздаёт таблицу, и отменить такое удаление невозможно:

<i>TRUNCATE TABLE table_name;</i>

<h2>* Как найти дубли в поле email? </h2>

<i>SELECT email, COUNT(email)<br>
FROM customers<br>
GROUP BY email<br>
HAVING COUNT(email) > 1;<br></i>

Функция COUNT() возвращает количество строк из поля email. Оператор HAVING работает почти так же, как и WHERE, вот только применяется не для всех столбцов, а для набора, созданного оператором GROUP BY.

<h2>* Замените в таблице зарплату работника на 1000, если она равна 900, и на 1500 в остальных случаях</h2>

Замена значений — одна из наиболее часто встречаемых задач по SQL на собеседованиях. Решить её несложно:

<i>
UPDATE table SET salary = <br>
CASE<br>
WHEN salary = 900 THEN 1000<br>
ELSE 1500<br>
END;<br>
</i>

Оператор UPDATE используется для изменения существующих записей. Но ответы на подобные вопросы с собеседований по SQL должны быть более развёрнутыми. Уточните,что после UPDATE следует указать, какие записи должны быть обновлены. В противном случае обновятся все записи в таблице.

В нашем примере условие задаётся через оператор CASE: если текущая зарплата равна 900, изменяем её на 1000, в остальных случаях — на 1500.

<h2>* Переименуйте таблицу</h2>
<i>ALTER TABLE first_table RENAME second_table;</i>

С помощью оператора ALTER TABLE можно добавлять, удалять, изменять столбцы, а также изменять название таблицы.


<h2>* Из каких подмножеств состоит SQL?</h2>
<p> &bull DDL (Data Definition Language, язык описания данных) — позволяет выполнять различные операции с базой данных, такие как CREATE (создание), ALTER (изменение) и DROP (удаление объектов).</p>
<p>&bull DML (Data Manipulation Language, язык управления данными) — позволяет получать доступ к данным и манипулировать ими, например, вставлять, обновлять, удалять и извлекать данные из базы данных.</p>
<p>&bull DCL (Data Control Language, язык контролирования данных) — позволяет контролировать доступ к базе данных. Пример — GRANT (предоставить права), REVOKE (отозвать права).<p>

<h2>* В чем разница между типом данных CHAR и VARCHAR в SQL?</h2>

И Char, и Varchar служат символьными типами данных, но varchar используется для строк символов переменной длины, тогда как Char используется для строк фиксированной длины. Например, char(10) может хранить только 10 символов и не сможет хранить строку любой другой длины, тогда как varchar(10) может хранить строку любой длины до 10, т.е. например 6, 8 или 2.

<h2>* Оконные функции</h2>
Это функции, которые позволяют осуществлять вычисления в заданном диапазоне строк внутри предложения Select.

Синтаксис:

Оконная функция (столбец для вычислений) OVER ([PARTITION BY столбец для группировки] [ORDER BY столбец для сортировки] [ROWS или RANGE выражение для ограничения строк в пределах группы])
sum(amount) - пример оконной функции, partition by id (оконная функции по id). 

<h2>* Хранимые процедуры (Stored procedures)</h2>
Это функции которые лежат в БД и могут вызваны разными запросами несколько раз. 

Синтаксис:

CREATE [OR REPLACE] FUNCTION function_name (arguments) 
RETURNS return_datatype AS $variable_name$
   DECLARE
      declaration;
      [...]
   BEGIN
      < function_body >
      [...]
      RETURN { variable_name | value }
   END; LANGUAGE plpgsql;


[OR REPLACE] - модификация существующего метода,

<h2>* Функции Row_number(), Partition, Lag</h2>
Row_number - указывает номер строки,<br>
Partition - для расчета агрегата по определенной колонке,<br>
Lag - функция лага, для получения доступа к предыдущей строке. <br> 

<h2>* Self join</h2>
Объединение таблицы саму на себя. 
Например есть таблица с id работников + id менеджера. 
В случае есть мы хотим получить результат и чтобы там отображалось имя и фамилия менеджера работника необходимо объединить одну и ту же таблицу. 

Пример запроса:<br>
SELECT emp.employee_id, emp.first_name, emp.last_name, emp.manager_id,
    mgr.first_name, mgr.last_name <br>
FROM employee emp <br>
LEFT JOIN ON employee mgr ON emp.manager_id=mgr.employee_id; <br>







